<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Smart Writer - Antigravity</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-color: #0f172a;
            --sidebar-bg: #1e293b;
            --text-color: #e2e8f0;
            --accent-color: #3b82f6;
            --accent-hover: #2563eb;
            --border-color: #334155;
            --success-color: #22c55e;
            --thought-bg: #1e293b;
            --thought-text: #94a3b8;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 350px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .logo span {
            color: var(--accent-color);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-size: 14px;
            font-weight: 500;
            color: #94a3b8;
        }

        textarea,
        input {
            background-color: #0f172a;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-family: inherit;
            font-size: 14px;
            resize: none;
            transition: border-color 0.2s;
        }

        textarea:focus,
        input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        textarea {
            min-height: 120px;
            line-height: 1.5;
        }

        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: var(--accent-hover);
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 40px 60px;
            overflow-y: auto;
            position: relative;
        }

        .paper {
            max-width: 800px;
            margin: 0 auto;
            background-color: transparent;
        }

        .status-bar {
            margin-bottom: 20px;
            display: none;
        }

        .thinking-box {
            background-color: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 30px;
            font-size: 14px;
            color: var(--thought-text);
            font-family: 'Fira Code', monospace;
            display: none;
        }

        .thinking-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 12px;
        }

        .thinking-content {
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .thinking-step {
            margin-bottom: 8px;
            padding-left: 12px;
            border-left: 2px solid var(--accent-color);
        }

        .thinking-action {
            color: var(--accent-color);
            font-weight: bold;
        }

        .article-content {
            font-size: 18px;
            line-height: 1.8;
            color: #e2e8f0;
        }

        .article-content h1 {
            font-size: 2.5em;
            margin-bottom: 0.5em;
            letter-spacing: -0.02em;
        }

        .article-content h2 {
            font-size: 1.8em;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            color: white;
        }

        .article-content h3 {
            font-size: 1.4em;
            margin-top: 1.2em;
            margin-bottom: 0.5em;
            color: white;
        }

        .article-content p {
            margin-bottom: 1.5em;
        }

        .article-content ul,
        .article-content ol {
            margin-bottom: 1.5em;
            padding-left: 1.5em;
        }

        .article-content li {
            margin-bottom: 0.5em;
        }

        .article-content blockquote {
            border-left: 4px solid var(--accent-color);
            padding-left: 20px;
            margin-left: 0;
            font-style: italic;
            color: #94a3b8;
        }

        /* Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <div class="logo">
            <span>⚡</span> Antigravity Writer
        </div>

        <div class="form-group">
            <label>Nhiệm vụ / Chủ đề</label>
            <textarea id="promptInput" placeholder="Viết một bài blog thật cuốn hút cho bài blog về 'cháo ăn dặm cho con'. Yêu cầu có số liệu dẫn chứng cụ thể. có hình ảnh, cung cấp giá trị cốt lõi mà người dùng cần trong bài viết
5...">Viết một bài blog thật cuốn hút cho bài blog về 'cháo ăn dặm cho con'. Yêu cầu có số liệu dẫn chứng cụ thể. có hình ảnh, cung cấp giá trị cốt lõi mà người dùng cần trong bài viết
</textarea>
        </div>

        <div class="form-group">
            <label>Chế độ</label>
            <select id="modeSelect" class="input"
                style="background:#0f172a; color:white; border:1px solid #334155; padding:10px; border-radius:8px;">
                <option value="smart">Smart Writer (Tư duy & Tìm kiếm)</option>
                <option value="fast">Fast (Viết nhanh)</option>
            </select>
        </div>

        <button id="generateBtn" class="btn" onclick="generateArticle()">
            <span>Bắt đầu viết</span>
        </button>

        <div style="margin-top:auto; font-size:12px; color:#64748b; text-align:center;">
            Powered by Antigravity AI
        </div>
    </div>

    <div class="main-content">
        <div class="paper">
            <!-- Thinking Process Area -->
            <div id="thinkingBox" class="thinking-box">
                <div class="thinking-header">
                    <div class="spinner" id="thinkSpinner"></div>
                    <span id="thinkStatus">AI ĐANG SUY NGHĨ & TÌM KIẾM...</span>
                </div>
                <div id="thinkingLog" class="thinking-content"></div>
            </div>

            <!-- Final Content Area -->
            <div id="articleOutput" class="article-content">
                <div style="text-align: center; color: #475569; margin-top: 100px;">
                    <h2>Sẵn sàng sáng tạo</h2>
                    <p>Nhập chủ đề bên trái để AI bắt đầu quá trình nghiên cứu và viết bài.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/v1/agent/smart';

        async function generateArticle() {
            const prompt = document.getElementById('promptInput').value.trim();
            if (!prompt) return alert('Vui lòng nhập chủ đề!');

            const btn = document.getElementById('generateBtn');
            const thinkingBox = document.getElementById('thinkingBox');
            const thinkingLog = document.getElementById('thinkingLog');
            const articleOutput = document.getElementById('articleOutput');
            const thinkSpinner = document.getElementById('thinkSpinner');
            const thinkStatus = document.getElementById('thinkStatus');

            // Reset UI
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> Đang xử lý...';
            thinkingBox.style.display = 'block';
            thinkSpinner.style.display = 'block';
            thinkStatus.textContent = "AI ĐANG KHỞI ĐỘNG...";
            thinkingLog.innerHTML = '';
            articleOutput.innerHTML = ''; // Clear previous

            // Prepare Request
            const payload = {
                prompt: prompt,
                messages: [{ role: "user", content: prompt }]
            };

            // Simulate "Thinking" update (Since connection is standard HTTP, we can't stream the thoughts easily without SSE changes on server)
            // But we can parse the final output which contains the thoughts.
            // Or better: show a generic loading state that cycles messages.

            const loadingMessages = [
                "Đang phân tích yêu cầu...",
                "Đang lên kế hoạch tìm kiếm...",
                "Đang tra cứu dữ liệu từ Google...",
                "Đang tổng hợp thông tin...",
                "Đang soạn thảo nội dung..."
            ];

            let msgIdx = 0;
            const msgInterval = setInterval(() => {
                const msg = loadingMessages[msgIdx % loadingMessages.length];
                thinkStatus.textContent = msg;
                msgIdx++;
            }, 3000);

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                clearInterval(msgInterval);

                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.json();
                const fullText = data.result || "";

                // Parsing Logic
                // The server returns "### Process of Thinking..." followed by "---" then content.

                const splitMarker = "---";
                let thoughts = "";
                let mainContent = fullText;

                if (fullText.includes("### Process of Thinking & Synthesis")) {
                    const parts = fullText.split(splitMarker);
                    // Assuming the first part is thoughts, the rest is content
                    if (parts.length > 1) {
                        thoughts = parts[0].replace("### Process of Thinking & Synthesis", "").trim();
                        mainContent = parts.slice(1).join(splitMarker).trim();
                    }
                }

                // Render Thoughts
                thinkSpinner.style.display = 'none';
                thinkStatus.textContent = "QUÁ TRÌNH TƯ DUY HOÀN TẤT";

                if (thoughts) {
                    // Format thoughts nicely
                    const formattedThoughts = thoughts.split('\n').map(line => {
                        if (line.startsWith('>')) {
                            if (line.includes('**Action**')) return `<div class="thinking-step thinking-action">${line.replace('>', '').trim()}</div>`;
                            return `<div class="thinking-step">${line.replace('>', '').trim()}</div>`;
                        }
                        return line;
                    }).join('');
                    thinkingLog.innerHTML = formattedThoughts;
                } else {
                    thinkingBox.style.display = 'none';
                }

                // Render Main Content
                articleOutput.innerHTML = marked.parse(mainContent);

            } catch (error) {
                console.error(error);
                articleOutput.innerHTML = `<div style="color:#ef4444; padding:20px; background:rgba(239,68,68,0.1); border-radius:8px;">
                    <h3>Có lỗi xảy ra</h3>
                    <p>${error.message}</p>
                </div>`;
                thinkStatus.textContent = "LỖI";
                clearInterval(msgInterval);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>Viết bài khác</span>';
            }
        }
    </script>
</body>

</html>